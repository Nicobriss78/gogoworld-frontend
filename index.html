<!DOCTYPE html>
<html lang="it">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>GoGoWorld.life – Homepage 0</title>
  <link rel="stylesheet" href="style.css" />
  <meta name="robots" content="noindex" />

</head>
<body>
  <main class="container home0">
    <header class="app-header">
      <h1 class="app-title">GoGoWorld.life</h1>
      <p class="subtitle">Scegli come entrare</p>
    </header>
<!-- B1/2 banner placement: home_top -->
    <section id="banner-home-top" class="banner-slot" style="margin: 12px 0;"></section>
    <section class="role-grid">
      <button id="btnOrganizer" class="btn role-btn left">Sono un Organizzatore</button>
      <button id="btnParticipant" class="btn role-btn right">Sono un Partecipante</button>
    </section>

    <section class="register-cta">
      <button id="btnRegister" class="btn btn-secondary">Registrati</button>
    </section>

    <footer class="app-footer">
      <small>© GoGoWorld.life</small>
    </footer>
  </main>

  <!-- modulo (coerente anche se index.js non importa) -->
  <script type="module" src="js/index.js"></script>
  <script>
    // Listener globale per retry API (503/502/504)
    window.addEventListener("api:status", (e) => {
      const { phase, attempt, status } = e.detail || {};
      if (phase === "retry") {
        try {
          showAlert(`⏳ Server in riattivazione… (tentativo ${attempt})`, "info", { autoHideMs: 1500 });
        } catch {
          console.info("Server in riattivazione… tentativo", attempt, "status", status);
        }
      }
    });
    // ------------------------------------------------------------
    // B1/2 — Banner widget (placement: home_top)
    // ------------------------------------------------------------
    (function () {
      function getApiBase() {
        // Usa variabile globale se definita, altrimenti backend prod; in dev localhost:3000
        if (window.API_BASE && typeof window.API_BASE === "string") return window.API_BASE;
        return location.hostname.includes("localhost") ? "http://localhost:3000" : "https://gogoworld-api.onrender.com";
      }

      async function loadBanner(placement, mountId, area) {
        try {
          const api = getApiBase();
          const params = new URLSearchParams({ placement });
          if (area && area.country) params.append("country", area.country);
          if (area && area.region) params.append("region", area.region);

          const res = await fetch(`${api}/api/banners/active?` + params.toString(), { method: "GET" });
          if (res.status === 204) return; // nessun banner disponibile
          const json = await res.json();
          if (!json || !json.ok || !json.data) return;

          const b = json.data;
          const mount = document.getElementById(mountId);
          if (!mount) return;

          // Link diretto all’endpoint click con redirect=1 (tracking lato BE + 302 al target)
          const clickHref = `${api}/api/banners/${encodeURIComponent(b.id)}/click?redirect=1`;

          mount.innerHTML = `
            <a href="${clickHref}" class="banner-card" rel="nofollow noopener" style="display:block;text-decoration:none;">
              <img src="${b.imageUrl}" alt="${b.title}" style="width:100%;height:auto;display:block;border-radius:8px;" />
              <span class="banner-label" style="display:block;margin-top:6px;font-size:.9rem;color:#555;">${b.title}</span>
            </a>
          `;
        } catch (err) {
          console.warn("[banner] home_top load error:", err);
        }
      }

      document.addEventListener("DOMContentLoaded", () => {
        // Per B1/2 usiamo country=IT; la region verrà integrata quando abiliteremo la geolocalizzazione
        loadBanner("home_top", "banner-home-top", { country: "IT" });
      });
    })();

  </script>
</body>
</html>






